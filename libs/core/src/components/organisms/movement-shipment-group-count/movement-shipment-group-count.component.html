<div class="metric">
  <lib-card-box
    *ngIf="!isLoading"
    title="{{ titleName | content }}"
    [dataAutomationHeader]="dataAutomationAttr + 'Header'"
    [dataAutomationTitle]="dataAutomationAttr + 'Title'"
    [headerClass]="'no-wrap'"
    [contentClass]="'mb-0'"
    [headerLeftTemplate]="headerLeftTemplate"
    [showLearnMoreInTooltip]="'true'"
    (learnMoreClick)="onViewDataClick()"
  >
    <div class="d-flex card-box-tile-wrapper">
      <div *ngIf="config?.total" class="total-tile-wrapper card-box-tile">
        <ng-container
          [ngTemplateOutlet]="totalCountTileTemplate"
        ></ng-container>
      </div>
      <ng-container *ngFor="let count of config?.counts; let i = index">
        <div class="tile-wrapper card-box-tile">
          <ng-container
            [ngTemplateOutlet]="tileTemplate"
            [ngTemplateOutletContext]="{ count: count, index: i }"
          >
          </ng-container>
        </div>
      </ng-container>
    </div>
  </lib-card-box>
</div>

<!-- Loader -->
<div
  *ngIf="isLoading"
  [ngClass]="{
    total: config?.total
  }"
  class="loader"
></div>

<ng-template #totalCountTileTemplate>
  <a
    class="d-flex total-tile tile"
    role="button"
    tabindex="0"
    (click)="onTileClick($event, config?.total)"
    (keyup.enter)="onTileClick($event, config?.total)"
    [attr.data-automation]="
      ('lbl_hld_dashboard_' + config?.total.id | content)
        ?.toLowerCase()
        .split(' ')
        .join('-') + '-box'
    "
  >
    <span
      class="h4 title"
      [attr.data-automation]="
        ('lbl_hld_dashboard_' + config?.total.id | content)
          ?.toLowerCase()
          .split(' ')
          .join('-') + '-box-heading'
      "
      >{{ "lbl_hld_dashboard_" + config?.total.id | content }}</span
    >
    <span
      class="count total-count d-flex align-items-center"
      [attr.data-automation]="
        ('lbl_hld_dashboard_' + config?.total.id | content)
          ?.toLowerCase()
          .split(' ')
          .join('-') + '-box-count'
      "
      >{{ config?.total.count | number }}
      <i
        class="symphony-icons symphony-icons-arrow-right-light count-arrow h5"
      ></i>
    </span>
  </a>
</ng-template>

<ng-template #tileTemplate let-count="count" let-i="index">
  <a
    class="d-flex flex-column tile count-tile"
    role="button"
    tabindex="0"
    (click)="onTileClick($event, count)"
    (keyup.enter)="onTileClick($event, count)"
    [attr.data-automation]="
      ('lbl_hld_dashboard_' + count.id | content)
        ?.toLowerCase()
        .split(' ')
        .join('-') + '-box'
    "
  >
    <span
      class="h4 title"
      [attr.data-automation]="
        ('lbl_hld_dashboard_' + count.id | content)
          ?.toLowerCase()
          .split(' ')
          .join('-') + '-box-heading'
      "
      >{{ "lbl_hld_dashboard_" + count.id | content }}</span
    >
    <div class="count-wrapper d-flex align-items-center">
      <i
        *ngIf="!count.isSVG"
        class="count-icon symphony-icons symphony-icons-{{ count.icon }}"
        [ngStyle]="styles"
        aria-hidden="true"
        [attr.data-automation]="
          ('lbl_hld_dashboard_' + count.id | content)
            ?.toLowerCase()
            .split(' ')
            .join('-') + '-box-icon'
        "
      ></i>
      <div [ngStyle]="styles" *ngIf="count.isSVG" class="count-svg">
        <img
          alt="{{ count?.icon }}"
          src="{{ '/scs/assets/' + count.icon + '.svg' }}"
        />
      </div>
      <span
        class="count shipment-count"
        [attr.data-automation]="
          ('lbl_hld_dashboard_' + count.id | content)
            ?.toLowerCase()
            .split(' ')
            .join('-') + '-box-count'
        "
        >{{ count.count | number }}</span
      >
      <i
        class="symphony-icons symphony-icons-arrow-right-light count-arrow h5"
      ></i>
    </div>
  </a>
</ng-template>

<ng-template #headerLeftTemplate>
  <lib-filter-chip
    [showHeading]="false"
    [selectedFilters]="selectedChipFilters"
    [defaultFilters]="defaultChipFilters"
    [containerClass]="'componentLevel'"
    (editFilter)="openFilter.emit($event)"
    [componentFilterId]="componentFilterId"
    [alwaysEditable]="true"
    [showClear]="false"
  >
  </lib-filter-chip>
</ng-template>

<lib-context-help
  [showModal]="isViewDataClicked"
  [modalTitle]="(titleName | content) + learnmoreModalTitleDate"
  [tableTitle]="titleName"
  [tableData]="learnMoreTableData"
  [contentHtmlKey]="titleName + '_learn_more_html'"
  pageSection="Dashboard"
  [hasApiFailed]="config?.hasApiFailed"
  errorReason="Shipment Exceptions Api Failed"
  (modalClosed)="onViewDataClick()"
  [isTableRowClickable]="true"
  (tableRowClicked)="onTileClick(null, $event.data)"
>
</lib-context-help>
