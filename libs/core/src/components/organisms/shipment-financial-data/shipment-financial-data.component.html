<div class="metric">
  <mat-card *ngIf="!isLoading" class="app-card" class="mat-elevation-z0">
    <mat-card-header *ngIf="titleName" class="no-wrap">
      <mat-card-title>
        <div class="exception-msg-container">
          <h3 class="h4 card-header">
            <div class="header" tabindex="0">
              <span [attr.data-automation]="dataAutomationAttr + 'header'">{{
                titleName
              }}</span>
              <span
                *ngIf="config?.data?.totalcustomerCharge"
                [attr.data-automation]="dataAutomationAttr + 'header-currency'"
                >&nbsp;
                {{ config?.data?.totalcustomerChargeCurrency || "" }}
              </span>
            </div>
            <lib-learn-more
              [learnMoreType]="LearnMoreTypes.TwoColumnsWithSubValue"
              [modalTitle]="(learnMoreTitle | content) + filterLabel"
              [tableTitle]="learnMoreTitle | content"
              [modalData]="learnMoreTableData"
              [attrToFetchData]="attrToFetchData"
              [contentHtmlKey]="learnMoreContentHtmlKey"
              pageSection="Financial"
              [hasApiFailed]="config?.hasApiFailed"
              errorReason="Shipment Financial Summary Api Failed"
              [isTableRowClickable]="enableFinantialTabDrillDown"
              (tableRowClicked)="tableRowClicked($event)"
              [dataAutomationAttr]="'financial-spending-card-learn-more'"
            ></lib-learn-more>
          </h3>
          <div *ngIf="isFilterChipVisible" class="header-left">
            <ng-container *ngTemplateOutlet="headerLeftTemplate"></ng-container>
          </div>
        </div>
      </mat-card-title>
    </mat-card-header>
    <mat-card-content class="mb-0">
      <div class="body5">
        <div class="tile-container">
          <ng-container
            [ngTemplateOutlet]="tileVerticalTemplate"
            [ngTemplateOutletContext]="{ financialData: config?.data }"
          >
          </ng-container>
        </div>
      </div>
    </mat-card-content>
  </mat-card>
</div>

<!-- Loader -->
<div
  *ngIf="isLoading"
  class="loader sp-mb-20"
  [style]="{ height: '400px' }"
></div>

<ng-template
  #tileVerticalTemplate
  let-financialData="financialData"
  let-i="index"
>
  <ng-container *ngIf="!config?.hasApiFailed; else errorTemplate">
    <ng-container
      *ngIf="
        financialData && financialData.totalcustomerCharge;
        else noDataTemplate
      "
    >
      <a
        role="button"
        tabindex="0"
        [ngClass]="
          isFromGldPlatform || enableFinantialTabDrillDown ? 'tile' : ''
        "
        (click)="onTileClick($event)"
        (keyup.enter)="onTileClick($event)"
        [attr.data-automation]="'Financial-Drill-Down'"
      >
        <div
          class="financialData-wrapper"
          [ngClass]="
            financialData?.numberOfClaims !== ('shpt_fin_spend_na' | content) &&
            financialData?.numberOfClaims !== 0
              ? ''
              : 'financials-widget'
          "
        >
          <p
            class="h4 text-align-center"
            [attr.data-automation]="dataAutomationAttr + 'total-label'"
          >
            {{ "lbl_shipments_total" | content }}
          </p>
          <p
            class="h4 shipment-total"
            [attr.data-automation]="dataAutomationAttr + 'total-value'"
          >
            {{
              financialData.totalcustomerCharge
                | number: DECIMAL_NUMBER_DEFAULT_FORMAT
            }}
          </p>

          <!--Average cost per shipment-->
          <div class="row">
            <div class="col-sm-7 label">
              <span
                class="h4"
                [attr.data-automation]="dataAutomationAttr + 'ship-label'"
                >{{ "lbl_average_cost_per_shipment" | content }}</span
              >
            </div>
            <div class="col-sm-3 center-column">
              <span
                class="tile-content"
                [attr.data-automation]="dataAutomationAttr + 'ship-value'"
              >
                {{
                  financialData.averageCostPerShipment
                    ? (financialData.averageCostPerShipment
                      | number: DECIMAL_NUMBER_DEFAULT_FORMAT)
                    : ("shpt_fin_spend_na" | content)
                }}
              </span>
            </div>
            <div class="col-sm-2 right-column">
              <span
                *ngIf="financialData.differenceOfAvgCostPerShipment"
                [ngClass]="
                  financialData.differenceOfAvgCostPerShipment?.charAt(0) ===
                  '+'
                    ? 'tile-content delivery-status-color-1'
                    : 'tile-content delivery-status-color-0'
                "
                [attr.data-automation]="dataAutomationAttr + 'ship-percentage'"
              >
                {{ financialData.differenceOfAvgCostPerShipment }}
              </span>
              <span
                *ngIf="!financialData.differenceOfAvgCostPerShipment"
                class="tile-content"
                [attr.data-automation]="dataAutomationAttr + 'ship-percentage'"
              >
                {{ "shpt_fin_spend_na" | content }}
              </span>
            </div>
          </div>

          <!--Average cost per unit-->
          <div class="row">
            <div class="col-sm-7 label">
              <span
                class="h4"
                [attr.data-automation]="dataAutomationAttr + 'unit-label'"
              >
                {{ "dpf_financialShpts_avgCstPrUnit" | content }}
              </span>
            </div>
            <div class="col-sm-3 center-column">
              <span
                class="tile-content"
                [attr.data-automation]="dataAutomationAttr + 'unit-value'"
              >
                {{
                  financialData.averageCostPerUnit
                    ? (financialData.averageCostPerUnit
                      | number: DECIMAL_NUMBER_DEFAULT_FORMAT)
                    : ("shpt_fin_spend_na" | content)
                }}
              </span>
            </div>
            <div class="col-sm-2 right-column">
              <span
                *ngIf="financialData.differenceOfAvgCostPerUnit"
                [ngClass]="
                  financialData.differenceOfAvgCostPerUnit?.charAt(0) === '+'
                    ? 'tile-content delivery-status-color-1'
                    : 'tile-content delivery-status-color-0'
                "
                [attr.data-automation]="dataAutomationAttr + 'ship-percentage'"
              >
                {{ financialData.differenceOfAvgCostPerUnit }}
              </span>
              <span
                *ngIf="!financialData.differenceOfAvgCostPerUnit"
                class="tile-content"
                [attr.data-automation]="dataAutomationAttr + 'unit-percentage'"
              >
                {{ "shpt_fin_spend_na" | content }}
              </span>
            </div>
          </div>
          <div
            class="row claimsDrillDown"
            (click)="onClaimsClick($event)"
            (keyup.enter)="onClaimsClick($event)"
            [attr.data-automation]="'Claims-Drill-Down'"
          >
            <div class="col-sm-7 label">
              <span [attr.data-automation]="dataAutomationAttr + 'number-icon'">
                <i
                  class="symphony-icons symphony-icons-claim"
                  aria-hidden="true"
                ></i>
              </span>
              <a
                href="javascript:void(0);"
                class="h4"
                [attr.data-automation]="dataAutomationAttr + 'number-label'"
              >
                {{ "lbl_shipments_number_of_claims" | content }}
              </a>
            </div>
            <div class="col-sm-3 center-column">
              <a
                href="javascript:void(0);"
                class="tile-content"
                [attr.data-automation]="dataAutomationAttr + 'number-value'"
              >
                {{ financialData.numberOfClaims }}
              </a>
            </div>
            <div class="col-sm-2 right-column"></div>
          </div>
          <div
            class="row status-line"
            [attr.data-automation]="dataAutomationAttr + 'disclaimer'"
          >
            {{ "shpt_fin_spend_average_by_status" | content }}
          </div>
        </div>
      </a>
    </ng-container>
  </ng-container>
</ng-template>

<ng-template #headerLeftTemplate>
  <lib-filter-chip
    [showHeading]="false"
    [selectedFilters]="selectedChipFilters"
    [defaultFilters]="defaultChipFilters"
    [containerClass]="'componentLevel'"
    (editFilter)="openFilter.emit($event)"
    [componentFilterId]="componentFilterId"
    [alwaysEditable]="true"
    [showClear]="false"
  >
  </lib-filter-chip>
</ng-template>

<!-- No Data -->
<ng-template #noDataTemplate>
  <div class="no-chart-data" [style]="customStyle">
    <span class="no-data-icon-bg-small">
      <i class="symphony-icons symphony-icons-component-error no-data-icon"></i>
    </span>
    <span class="body2">{{ "lbl_data_not_available_chart" | content }}</span>
  </div>
</ng-template>

<ng-template #errorTemplate>
  <lib-error
    variation="horizontal"
    [customStyle]="customStyle"
    errorReason="Financial Api Failed"
    pageSection="Financial"
  ></lib-error>
</ng-template>
