<!-- 9fbef606107a605d69c0edbcd8029e5d_SYMPHONY -->
<ng-container *ngIf="isOldChart; else newChart">
  <lib-card-box
    [title]="chartTitle"
    class="bar-chart-card"
    [attr.data-automation]="dataAutomationAttribute + '-card'"
    [dataAutomationHeader]="dataAutomationAttribute + '-header'"
    [headerRightTemplate]="
      !showLearnMoreInTooltip || showFilterChip ? headerRightTemplate : null
    "
    [showLearnMoreInTooltip]="showLearnMoreInTooltip"
    (learnMoreClick)="onViewDataClick()"
  >
    <div
      class="chart-container"
      [ngClass]="{
        'y-axis-scale-label': yAxisScaleLabel,
        'x-axis-scale-label': xAxisScaleLabel
      }"
      *ngIf="!hasApiFailed"
    >
      <div class="wip-wrapper" *ngIf="stacked">
        <wip-chart-filters
          (toggleChangedEvent)="toggleChanged($event)"
          [title]="chartTitle"
          [toggleTypes]="toggleTypes"
          [toggleValue]="toggleValue"
          [chartFilterForm]="chartFilterForm"
          [showCustomLegends]="showCustomLegends"
          [legendList]="legendList"
          [showModeFilter]="showModeFilter"
        ></wip-chart-filters>
        <wip-chart-legends
          [chartFilterForm]="chartFilterForm"
          [showCustomLegends]="showCustomLegends"
          [legendList]="legendList"
        ></wip-chart-legends>
      </div>
      <div
        class="chart"
        [ngClass]="{
          'no-scroll': !(stacked
            ? shipmentChartData[toggleValue || 0]?.shipmentData?.length > 0
            : shipmentChartData?.length > 0)
        }"
      >
        <lib-chart
          [showColorLabelTooltip]="showColorLabelTooltip"
          [isWIPChart]="stacked"
          [chartId]="chartId"
          [chartType]="chartType"
          [chartData]="chartData"
          [chartOptions]="chartOptions"
          [ariaLabel]="ariaLabel"
          [yAxisLabel]="yAxisLabel"
          [noDataMessage]="noDataMessage"
          (clickOnChartEvent)="clickOnChart($event)"
          [emitClickEvent]="emitClickEvent || enableDrilldown"
          [showYAxesLabel]="showYAxesLabel"
          [customTooltipCallback]="customTooltipCallback"
        ></lib-chart>
      </div>
    </div>
    <div *ngIf="hasApiFailed">
      <lib-error
        variation="component"
        [customStyle]="customStyle"
        [errorReason]="errorReason"
        [pageSection]="pageSection"
      ></lib-error>
    </div>
  </lib-card-box>
</ng-container>
<ng-template #newChart>
  <div class="chart-container-stacked" *ngIf="!hasApiFailed">
    <div class="legends-wrapper">
      <wip-chart-legends
        [chartFilterForm]="chartFilterForm"
        [showCustomLegends]="showCustomLegends"
        [legendList]="legendList"
        [customStyle]="customLegendsStyle"
        [dataAutomationAttribute]="dataAutomationAttribute"
      ></wip-chart-legends>
    </div>
    <div
      class="chart"
      [ngClass]="{
        'no-scroll': !(stacked
          ? shipmentChartData[toggleValue || 0]?.shipmentData?.length > 0
          : shipmentChartData?.length > 0)
      }"
    >
      <lib-chart
        [showColorLabelTooltip]="showColorLabelTooltip"
        [isDeliveryPerformanceChart]="stacked"
        [chartId]="chartId"
        [chartType]="chartType"
        [chartData]="chartData"
        [chartOptions]="chartOptions"
        [ariaLabel]="ariaLabel"
        [yAxisLabel]="yAxisLabel"
        [noDataMessage]="noDataMessage"
        (clickOnChartEvent)="clickOnChart($event)"
        [emitClickEvent]="emitClickEvent || enableDrilldown"
        [showYAxesLabel]="showYAxesLabel"
        [customTooltipCallback]="customTooltipCallback"
      ></lib-chart>
    </div>
  </div>
  <div *ngIf="hasApiFailed">
    <lib-error
      variation="component"
      [customStyle]="customStyle"
      [errorReason]="errorReason"
      [pageSection]="pageSection"
    ></lib-error>
  </div>
</ng-template>

<lib-chart-modal
  [showModal]="isViewDataClicked"
  [isMultiColumnOrTableLayout]="stacked"
  [toggleTypes]="toggleTypes"
  [modalTitle]="modalTitle"
  [modalData]="learnMoreData ? learnMoreData : shipmentChartData"
  [attrToFetchData]="attrToFetchData"
  [contentHtmlKey]="contentHtmlKey"
  [hasApiFailed]="hasApiFailed"
  [pageSection]="pageSection"
  [errorReason]="errorReason"
  (modalClosed)="onModalClose($event)"
  (tableRowClicked)="clickOnChart($event)"
  [isTableRowClickable]="emitClickEvent || enableDrilldown"
  [tableTitle]="learnMoreTableTitle"
></lib-chart-modal>

<ng-template #headerRightTemplate>
  <div class="learn-more" *ngIf="!showLearnMoreInTooltip">
    <lib-button
      variation="link-button"
      (clickEvent)="onViewDataClick()"
      [text]="'lbl_chart_learn_more' | content"
      [ariaLabel]="learnMoreAriaLbl"
      size="sm"
    >
    </lib-button>
  </div>
  <div class="filter-chips" *ngIf="showFilterChip">
    <lib-filter-chip
      [showHeading]="false"
      [dataAutomationAttr]="dataAutomationAttributeFilterChip"
      [selectedFilters]="selectedFilters"
      [defaultFilters]="defaultFilters"
      [containerClass]="'componentLevel'"
      (editFilter)="openFilter.emit($event)"
      (changedFilters)="chipFilterRemoved.emit($event)"
      [componentFilterId]="chartId"
      [alwaysEditable]="true"
      [showClear]="false"
    ></lib-filter-chip>
  </div>
</ng-template>
