<mat-card
  *ngIf="!isLoading"
  class="app-card"
  class="mat-elevation-z0 lane-card"
>
  <mat-card-header *ngIf="title" class="lane-card-header">
    <mat-card-title>
      <div class="exception-msg-container">
        <h3 class="h4 card-header">
          <span [attr.data-automation]="'top-lane-cost-card-name'">{{
            (title | content) +
              " " +
              (config?.data?.totalcustomerCharge
                ? config.data.totalcustomerChargeCurrency || ""
                : "")
          }}</span>
          <lib-learn-more
            [learnMoreType]="LearnMoreTypes.TwoColumns"
            [modalTitle]="learnMoreModalTitle"
            [modalData]="learnMoreData"
            [attrToFetchData]="attributesToFetchData"
            [contentHtmlKey]="contentHtmlKey"
            pageSection="Financial Tab"
            [hasApiFailed]="config?.hasApiFailed"
            errorReason="Financial Summary Api Failed"
            [isTableRowClickable]="true"
            [isTableColumnClickable]="false"
            (tableRowClicked)="onLearnMoreRowClick($event)"
            [tableTitle]="learnMoreModalTitle?.split('-')[0].trim()"
          ></lib-learn-more>
        </h3>
      </div>
    </mat-card-title>
  </mat-card-header>
  <mat-card-content class="mb-0">
    <div class="body5 lane-card-container">
      <ng-container
        [ngTemplateOutlet]="laneCardTemplate"
        [ngTemplateOutletContext]="{
          financialLaneSummaryData: financialLaneSummaryData,
          config: config
        }"
      >
      </ng-container>
    </div>
  </mat-card-content>
</mat-card>

<!-- Loader -->
<div
  *ngIf="isLoading"
  class="loader sp-mb-20"
  [style]="{ height: '400px' }"
></div>

<ng-template
  #laneCardTemplate
  let-financialLaneSummaryData="financialLaneSummaryData"
  let-config="config"
>
  <ng-container *ngIf="!config?.hasApiFailed; else errorTemplate">
    <ng-container
      *ngIf="financialLaneSummaryData?.length > 0; else noDataTemplate"
    >
      <a
        href="javascript:void(0);"
        class="d-flex lane-card-row body-2 align-items-center"
        (click)="onRowClick(laneData)"
        (keyup.enter)="onRowClick(laneData)"
        *ngFor="let laneData of financialLaneSummaryData"
        [attr.data-automation]="'top-lane-cost-card-row'"
      >
        <div class="d-flex lane-text">
          <span
            class="origin-text"
            [attr.data-automation]="'top-lane-cost-card-from'"
            >{{ laneData.originCity + ", " + laneData.originCountry }}</span
          >
          <span
            class="arrow-icon"
            [attr.data-automation]="'top-lane-cost-card-arrow-icon'"
          >
            <i
              aria-hidden="true"
              class="card-icon symphony-icons symphony-icons-arrow-right-small"
            ></i>
          </span>
          <span
            class="destination-text"
            [attr.data-automation]="'top-lane-cost-card-to'"
            >{{
              laneData.destinationCity + ", " + laneData.destinationCountry
            }}</span
          >
        </div>
        <span
          class="text-right charge-text"
          [attr.data-automation]="'top-lane-cost-card-row-value'"
          >{{ laneData.totalcustomerCharge }}</span
        >
      </a>
    </ng-container>
  </ng-container>
</ng-template>

<!-- No Data -->
<ng-template #noDataTemplate>
  <ng-container
    *ngTemplateOutlet="
      noDataTemplateRef;
      context: {
        customStyle: customStyle
      }
    "
  ></ng-container>
</ng-template>

<!-- Error Template -->
<ng-template #errorTemplate>
  <lib-error
    variation="horizontal"
    [customStyle]="customStyle"
    errorReason="Financial Api Failed"
    pageSection="Financial"
  ></lib-error>
</ng-template>
