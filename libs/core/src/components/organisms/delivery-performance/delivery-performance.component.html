<!-- 9fbef606107a605d69c0edbcd8029e5d_SYMPHONY -->

<ng-template #headerLeftTemplate>
  <form
    [formGroup]="performanceForm"
    [attr.data-automation]="dataAutomationAttr + '-tile-dropdown'"
  >
    <lib-select
      [optionLists]="dropdownOptions"
      (selectionChange)="changeLayout()"
      [selectedValue]="
        isDonut ? dropdownOptions[0].value : dropdownOptions[1].value
      "
      [controlName]="'performanceBy'"
      [customStyle]="selectBoxStyle"
      [getValueFromCMS]="false"
      showSelectValueToUser="true"
      [showAutomationAttrForOptions]="true"
      [dataAutomationAttribute]="dataAutomationAttr + '-tile-dropdown'"
    ></lib-select>
  </form>
</ng-template>

<ng-template #headerRightTemplate>
  <lib-filter-chip
    [showHeading]="false"
    [dataAutomationAttr]="dataAutomationAttr + '-tile-filter-chip'"
    [selectedFilters]="selectedChipFilters"
    [defaultFilters]="defaultChipFilters"
    [containerClass]="'componentLevel'"
    (editFilter)="openFilter.emit($event)"
    [componentFilterId]="componentFilterId"
    [alwaysEditable]="true"
    [showClear]="false"
  >
  </lib-filter-chip>
</ng-template>

<ng-template #PerfomanceChart>
  <div *ngIf="!hasSummaryApiFailed && !donutNoData" class="row">
    <div class="col-lg-5 col-md-6 d-flex flex-column justify-content-center">
      <div class="container-fluid delivery-status-links">
        <div class="row pb-3">
          <i
            [attr.data-automation]="
              dataAutomationAttr + '-pie-chart-delivered-on-time-icon'
            "
            class="symphony-icons symphony-icons-check-solid icon-checked"
          ></i>
          <a
            href="javascript:void(0)"
            class="link-btn-icon pl-2"
            (click)="onDonutChartClicked({ data: linksDrilldown.onTime })"
          >
            <span
              [attr.data-automation]="
                dataAutomationAttr + '-pie-chart-delivered-on-time-label'
              "
            >
              {{ "lbl_dashboard_delivered_on_time" | content }}
            </span>
            <i class="symphony-icons symphony-icons-arrow-right-light"></i>
          </a>
        </div>

        <div class="row">
          <i
            [attr.data-automation]="
              dataAutomationAttr + '-pie-chart-delivered-late-icon'
            "
            class="symphony-icons symphony-icons-exclamation-triangle-solid delivered-late"
          ></i>
          <a
            href="javascript:void(0)"
            class="link-btn-icon pl-1"
            (click)="onDonutChartClicked({ data: linksDrilldown.late })"
          >
            <span
              [attr.data-automation]="
                dataAutomationAttr + '-pie-chart-delivered-late-label'
              "
            >
              {{ "lbl_dashboard_delivered_late" | content }}
            </span>
            <i class="symphony-icons symphony-icons-arrow-right-light"></i>
          </a>
        </div>
      </div>
    </div>
    <div
      class="col-lg-7 col-md-6"
      [attr.data-automation]="dataAutomationAttr + '-pie-chart'"
    >
      <lib-donut-chart
        *ngIf="data"
        chartId="deliveryPerformanceChart"
        [data]="data"
        ariaLabel="{{ 'lbl_performance_aria_donut_chart' | content }}"
        tabindex="0"
        [option]="chartOptionsDonut"
        [attrToFetchData]="attributesToFetchData.chart"
        (drilldownEvent)="onDonutChartClicked($event)"
      >
      </lib-donut-chart>
    </div>
  </div>
</ng-template>

<ng-template #PerfomanceByModeChart>
  <div
    [attr.data-automation]="dataAutomationAttr + '-bar-chart'"
    *ngIf="!hasSummaryApiFailed && !donutNoData"
  >
    <lib-bar-chart
      [isOldChart]="false"
      [stacked]="true"
      [attrToFetchData]="attributesToFetchData.chart"
      [dataAutomationAttribute]="dataAutomationAttr + '-bar-chart'"
      [shipmentChartData]="shipmentChartData"
      [toggleValue]="toggleValue"
      [toggleTypes]="['deliveryPerformanceSummary']"
      [option]="chartOptionBar"
      [labelCustomMapping]="labelCustomMapping"
      [showYAxesLabel]="false"
      [stackedChartColors]="stackedChartColors"
      [emitClickEvent]="true"
      ariaLabel="{{ 'lbl_performance_mode_aria_chart' | content }}"
      (clickOnChartData)="clickOnModeChart($event)"
    >
    </lib-bar-chart>
  </div>
</ng-template>

<div [attr.data-automation]="dataAutomationAttr + '-tile'" *ngIf="!isLoading">
  <mat-card class="mat-elevation-z0 app-card">
    <mat-card-header>
      <mat-card-title>
        <div class="header-container">
          <div class="header-left">
            <ng-container *ngTemplateOutlet="headerLeftTemplate"></ng-container>
            <button
              *ngIf="isDesktopDevice"
              class="learn-more-info-icon"
              [libPopoverDirective]="learnMorePopoverTemplate"
              popoverPlacement="top"
              popoverType="tooltip"
              (click)="onViewDataClick()"
            >
              <span class="sr-only">
                {{ "lbl_chart_learn_more" | content }}
              </span>
              <i
                [attr.data-automation]="
                  dataAutomationAttr + '-tile-learn-more-icon'
                "
                class="card-icon symphony-icons symphony-icons-info-circle"
              ></i>
            </button>
            <button
              *ngIf="!isDesktopDevice"
              class="learn-more-info-icon"
              (click)="onViewDataClick()"
            >
              <i
                [attr.data-automation]="
                  dataAutomationAttr + '-tile-learn-more-icon'
                "
                class="card-icon symphony-icons symphony-icons-info-circle"
              ></i>
            </button>
          </div>
          <div class="header-right pl-1 pl-md-0 pl-xs-0">
            <ng-container
              *ngTemplateOutlet="headerRightTemplate"
            ></ng-container>
          </div>
        </div>
      </mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <div *ngIf="hasSummaryApiFailed">
        <lib-error
          variation="component"
          [customStyle]="{ height: '323px' }"
          errorReason="Summary API has failed"
          pageSection="Dashboard"
        ></lib-error>
      </div>
      <div *ngIf="!hasSummaryApiFailed && donutNoData && !isLoading">
        <div class="no-chart-data" [style]="{ height: '300px' }">
          <span class="no-data-icon-bg-small">
            <i
              class="symphony-icons symphony-icons-component-error no-data-icon"
              aria-hidden="true"
            ></i>
          </span>
          <span class="body2">{{ "lbl_data_not_available" | content }}</span>
        </div>
      </div>
      <ng-container
        *ngTemplateOutlet="isDonut ? PerfomanceChart : PerfomanceByModeChart"
      ></ng-container>
    </mat-card-content>
    <mat-card-footer> </mat-card-footer>
  </mat-card>
</div>
<div
  *ngIf="isLoading"
  class="loader sp-mb-20"
  [style]="{ height: '400px' }"
></div>

<lib-chart-modal
  [showModal]="isViewDataClicked"
  [isMultiColumnOrTableLayout]="!isDonut"
  [toggleTypes]="toggleTypes"
  [modalTitle]="
    isDonut ? modalTitles.modalTitleDefault : modalTitles.modalTitleMode
  "
  [tableTitle]="
    isDonut ? modalConfig.modalTitleDefault : modalConfig.modalTitleMode
  "
  [modalData]="isDonut ? data : shipmentChartData"
  [attrToFetchData]="
    isDonut ? attributesToFetchData.modal : attributesToFetchData.chart
  "
  [contentHtmlKey]="
    isDonut ? modalConfig.contentHtmlKeyDefault : modalConfig.contentHtmlKeyMode
  "
  pageSection="Dashboard"
  [hasApiFailed]="hasSummaryApiFailed"
  errorReason="Summary Api Failed"
  [customLabelMapping]="labelCustomMappingModal"
  (modalClosed)="onViewDataClick()"
  [isTableRowClickable]="true"
  [isTableColumnClickable]="!isDonut"
  (tableRowClicked)="
    isDonut ? onDonutChartClicked($event, true) : clickOnModeChart($event, true)
  "
></lib-chart-modal>

<ng-template #learnMorePopoverTemplate>
  <button (click)="onViewDataClick()" class="learn-more-link">
    {{ "lbl_chart_learn_more" | content }}
  </button>
</ng-template>
